# ì¤‘ê°„ ì‚½ì…(Mid-path Insertion) ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„

## ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜

### ìƒí™© ì„¤ëª…
ê¸°ì¡´ ëŒ€í™” ê²½ë¡œê°€ ë‹¤ìŒê³¼ ê°™ì„ ë•Œ:
```
A â†’ B â†’ C â†’ D â†’ E
```

ì‚¬ìš©ìê°€ **B ì‹œì ìœ¼ë¡œ ëŒì•„ê°€ì„œ** ìƒˆë¡œìš´ ëŒ€í™”(NEW)ë¥¼ ì‹œì‘í•˜ê³ ,
**ê¸°ì¡´ D, Eë¥¼ NEWì— ì—°ê²°**í•˜ê³  ì‹¶ì–´ í•¨:

```
ì›í•˜ëŠ” ê²°ê³¼:
A â†’ B â†’ NEW â†’ D â†’ E
       â†“
       C (ë¶„ê¸°ë¡œ ë³´ì¡´)
```

ë˜ëŠ”:
```
A â†’ B â†’ C
     â†“
     NEW â†’ D â†’ E
```

**í•µì‹¬ ì§ˆë¬¸**: Cë¥¼ ê±´ë„ˆë›°ê³  Dë¶€í„° NEWì— ì—°ê²°í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜?

---

## ë°©ì‹ A (í„´ ë‹¨ìœ„ ì¦‰ì‹œ ìƒì„±)ì—ì„œì˜ ì²˜ë¦¬

### ì´ˆê¸° ìƒíƒœ
```python
all_nodes = {
    "A": Node(id="A", parent=None, ...),
    "B": Node(id="B", parent="A", ...),
    "C": Node(id="C", parent="B", ...),
    "D": Node(id="D", parent="C", ...),
    "E": Node(id="E", parent="D", ...)
}
```

### ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰

#### 1ë‹¨ê³„: Bë¡œ ì´ë™
```python
/goto B
â†’ current_node_id = "B"
```

#### 2ë‹¨ê³„: ìƒˆ ëŒ€í™” ìƒì„±
```python
ì‚¬ìš©ì: "ìƒˆë¡œìš´ ì§ˆë¬¸"
AI: "ìƒˆë¡œìš´ ì‘ë‹µ"

â†’ NEW ë…¸ë“œ ìë™ ìƒì„±:
Node(id="NEW", parent="B", ...)

íŠ¸ë¦¬ ìƒíƒœ:
A â†’ B â†’ C â†’ D â†’ E
     â†“
     NEW
```

#### 3ë‹¨ê³„: Dë¥¼ NEWì˜ ìì‹ìœ¼ë¡œ ì¬ì—°ê²°
**ë¬¸ì œ**: ì´ ì‘ì—…ì„ ì–´ë–»ê²Œ ëª…ë ¹í•˜ë‚˜?

**ì˜µì…˜ 1: ëª…ì‹œì  ì¬ì—°ê²° ëª…ë ¹**
```python
/reparent D NEW
â†’ all_nodes["D"].parent_id = "NEW"

ê²°ê³¼:
A â†’ B â†’ C
     â†“
     NEW â†’ D â†’ E
```

**ì˜µì…˜ 2: ìˆ˜ë™ í¸ì§‘ ë¶ˆê°€ (ìë™ ìƒì„±ë§Œ)**
```
ë°©ì‹ Aì˜ ì›ì¹™: "ëª¨ë“  ë…¸ë“œëŠ” ìë™ ìƒì„±"
ì‚¬ìš©ìê°€ parent_idë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ëŠ” ê²ƒì€ ì›ì¹™ì— ì–´ê¸‹ë‚¨

ëŒ€ì•ˆ:
1. Dì˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ NEW í•˜ìœ„ì— ìƒˆ ë…¸ë“œ ìƒì„±
2. Eì˜ ë‚´ìš©ë„ ë³µì‚¬í•´ì„œ ìƒì„±
â†’ ë¹„íš¨ìœ¨ì 
```

**ê²°ë¡ **: ë°©ì‹ AëŠ” **parent_id ì¬í• ë‹¹ ê¸°ëŠ¥ì´ í•„ìš”í•¨**

---

## ë°©ì‹ B (ë²„í¼ ê¸°ë°˜)ì—ì„œì˜ ì²˜ë¦¬

### ì´ˆê¸° ìƒíƒœ

#### ì¼€ì´ìŠ¤ 1: ëª¨ë“  ëŒ€í™”ê°€ í•˜ë‚˜ì˜ ë…¸ë“œ
```python
all_nodes = {
    "node_1": Node(id="node_1", parent=None, messages=[
        {"role": "user", "content": "A ì§ˆë¬¸"},
        {"role": "assistant", "content": "A ì‘ë‹µ"},
        {"role": "user", "content": "B ì§ˆë¬¸"},
        {"role": "assistant", "content": "B ì‘ë‹µ"},
        {"role": "user", "content": "C ì§ˆë¬¸"},
        {"role": "assistant", "content": "C ì‘ë‹µ"},
        {"role": "user", "content": "D ì§ˆë¬¸"},
        {"role": "assistant", "content": "D ì‘ë‹µ"},
        {"role": "user", "content": "E ì§ˆë¬¸"},
        {"role": "assistant", "content": "E ì‘ë‹µ"}
    ])
}
```

**ë¬¸ì œ**: "B ì‹œì "ì´ë¼ëŠ” ê°œë…ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ!
- ë…¸ë“œ ë‚´ë¶€ì˜ íŠ¹ì • ë©”ì‹œì§€ ì¸ë±ìŠ¤ë¥¼ ì§€ì •í•´ì•¼ í•¨
- `/goto node_1 4` (5ë²ˆì§¸ ë©”ì‹œì§€ = B ì‘ë‹µ)

**ì¤‘ê°„ ì‚½ì… ì‹œë„**:
```python
# B ìœ„ì¹˜ ì°¾ê¸°
messages = all_nodes["node_1"].messages
b_index = 3  # B ì‘ë‹µì˜ ì¸ë±ìŠ¤

# ë…¸ë“œ ë¶„í•  í•„ìš”!
prefix_messages = messages[0:4]  # A, B
middle_message = [NEW ëŒ€í™”]
suffix_messages = messages[6:10]  # D, E (C ê±´ë„ˆëœ€)

# 3ê°œ ë…¸ë“œ ìƒì„±
node_AB = Node(id="node_AB", parent=None, messages=prefix_messages)
node_NEW = Node(id="node_NEW", parent="node_AB", messages=middle_message)
node_DE = Node(id="node_DE", parent="node_NEW", messages=suffix_messages)

# ì›ë³¸ ë…¸ë“œ ì‚­ì œ ë˜ëŠ” ë¹„í™œì„±í™”
```

**ë³µì¡ë„**: ë§¤ìš° ë†’ìŒ!

#### ì¼€ì´ìŠ¤ 2: ê° ì²´í¬í¬ì¸íŠ¸ë§ˆë‹¤ ë…¸ë“œ ìƒì„±
```python
all_nodes = {
    "node_AB": Node(id="node_AB", parent=None, messages=[A, B]),
    "node_C": Node(id="node_C", parent="node_AB", messages=[C]),
    "node_DE": Node(id="node_DE", parent="node_C", messages=[D, E])
}
```

**ì¤‘ê°„ ì‚½ì… ì‹œë„**:
```python
/goto node_AB
ì‚¬ìš©ì: "ìƒˆ ì§ˆë¬¸"
â†’ node_NEW ìƒì„± (parent="node_AB")

# node_DEë¥¼ ì¬ì—°ê²°
all_nodes["node_DE"].parent_id = "node_NEW"

ê²°ê³¼:
node_AB â†’ node_C
       â†“
       node_NEW â†’ node_DE
```

**ë¬¸ì œ**: node_DE ë‚´ë¶€ì— Dì™€ Eê°€ í•¨ê»˜ ìˆìŒ
- Dë§Œ ì¬ì—°ê²°í•˜ê³  ì‹¶ë‹¤ë©´? **ë…¸ë“œ ë¶„í•  í•„ìš”**

---

## ë…¸ë“œ ë¶„í• (Node Splitting) ë¡œì§

### ì •ì˜
í•˜ë‚˜ì˜ ë…¸ë“œë¥¼ ì—¬ëŸ¬ ê°œë¡œ ë‚˜ëˆ„ëŠ” ì‘ì—…

### ë°©ì‹ Aì—ì„œì˜ ë¶„í• 
```python
# ë°©ì‹ AëŠ” ì´ë¯¸ 1í„´ = 1ë…¸ë“œì´ë¯€ë¡œ
# ë¶„í• ì´ í•„ìš” ì—†ìŒ!

A, B, C, D, EëŠ” ì´ë¯¸ ê°ê° ë³„ë„ ë…¸ë“œ
â†’ ë‹¨ìˆœíˆ parent_idë§Œ ë³€ê²½í•˜ë©´ ë¨
```

### ë°©ì‹ Bì—ì„œì˜ ë¶„í• 
```python
def split_node(node_id: str, split_indices: List[int]) -> List[str]:
    """
    ë…¸ë“œë¥¼ ì—¬ëŸ¬ ê°œë¡œ ë¶„í• 

    Args:
        node_id: ë¶„í• í•  ë…¸ë“œ ID
        split_indices: ë¶„í•  ì§€ì  (ë©”ì‹œì§€ ì¸ë±ìŠ¤)

    Returns:
        ìƒˆë¡œ ìƒì„±ëœ ë…¸ë“œ ID ë¦¬ìŠ¤íŠ¸
    """
    original_node = all_nodes[node_id]
    messages = original_node.messages

    new_node_ids = []
    current_parent = original_node.parent_id

    # split_indicesì— ë”°ë¼ ë©”ì‹œì§€ ê·¸ë£¹ ìƒì„±
    groups = []
    start = 0
    for end in split_indices:
        groups.append(messages[start:end])
        start = end
    groups.append(messages[start:])  # ë§ˆì§€ë§‰ ê·¸ë£¹

    # ê° ê·¸ë£¹ì„ ìƒˆ ë…¸ë“œë¡œ ìƒì„±
    for i, group in enumerate(groups):
        new_node = Node(
            id=generate_uuid(),
            parent_id=current_parent,
            messages=group,
            ...
        )
        all_nodes[new_node.id] = new_node
        new_node_ids.append(new_node.id)

        # ë‹¤ìŒ ë…¸ë“œì˜ ë¶€ëª¨ëŠ” í˜„ì¬ ë…¸ë“œ
        current_parent = new_node.id

    # ì›ë³¸ ë…¸ë“œì˜ ìì‹ë“¤ì„ ë§ˆì§€ë§‰ ë…¸ë“œë¡œ ì¬ì—°ê²°
    for node in all_nodes.values():
        if node.parent_id == node_id:
            node.parent_id = new_node_ids[-1]

    # ì›ë³¸ ë…¸ë“œ ì‚­ì œ
    del all_nodes[node_id]

    return new_node_ids


# ì‚¬ìš© ì˜ˆì‹œ
# node_1 = [A, B, C, D, E] 10ê°œ ë©”ì‹œì§€
# B ì´í›„(4), C ì´í›„(6)ì—ì„œ ë¶„í• 

new_nodes = split_node("node_1", [4, 6])
# â†’ ["node_AB", "node_C", "node_DE"]
```

**ë³µì¡ë„**: ë§¤ìš° ë†’ìŒ!

---

## ì¤‘ê°„ ì‚½ì… ì „ì²´ íë¦„ ë¹„êµ

### ë°©ì‹ A (1í„´ = 1ë…¸ë“œ)

```python
# 1. ì´ˆê¸° ìƒíƒœ
A â†’ B â†’ C â†’ D â†’ E

# 2. /goto B
current_node_id = "B"

# 3. ìƒˆ ëŒ€í™”
ì‚¬ìš©ì: "NEW ì§ˆë¬¸"
â†’ NEW ë…¸ë“œ ìë™ ìƒì„± (parent="B")

íŠ¸ë¦¬: A â†’ B â†’ C â†’ D â†’ E
          â†“
          NEW

# 4. Dë¥¼ NEWë¡œ ì¬ì—°ê²°
/reparent D NEW

â†’ all_nodes["D"].parent_id = "NEW"

# ìµœì¢…
A â†’ B â†’ C
     â†“
     NEW â†’ D â†’ E
```

**ë‹¨ê³„**: 4ë‹¨ê³„
**ë³µì¡ë„**: â­â­ (parent_id ë³€ê²½ë§Œ)

---

### ë°©ì‹ B (ë²„í¼ ê¸°ë°˜) - ìµœì•…ì˜ ê²½ìš°

```python
# 1. ì´ˆê¸° ìƒíƒœ (ëª¨ë“  ëŒ€í™”ê°€ í•˜ë‚˜ì˜ ë…¸ë“œ)
node_1 = [A, B, C, D, E] (10ê°œ ë©”ì‹œì§€)

# 2. B ì‹œì  ì°¾ê¸°
b_index = 3

# 3. ë…¸ë“œ ë¶„í• 
/split node_1 4 6
â†’ ["node_AB", "node_C", "node_DE"] ìƒì„±

íŠ¸ë¦¬: node_AB â†’ node_C â†’ node_DE

# 4. /goto node_AB
current_node_id = "node_AB"

# 5. ìƒˆ ëŒ€í™”
ì‚¬ìš©ì: "NEW ì§ˆë¬¸"
â†’ node_NEW ìƒì„± (parent="node_AB")

íŠ¸ë¦¬: node_AB â†’ node_C
           â†“
           node_NEW

# 6. node_DE ì¬ì—°ê²°
/reparent node_DE node_NEW

íŠ¸ë¦¬: node_AB â†’ node_C
           â†“
           node_NEW â†’ node_DE

# 7. node_Cë¥¼ node_ABì˜ ìì‹ìœ¼ë¡œ ìœ ì§€ (ì´ë¯¸ ê·¸ë ‡ê²Œ ë˜ì–´ ìˆìŒ)

# ìµœì¢…
node_AB â†’ node_C
       â†“
       node_NEW â†’ node_DE
```

**ë‹¨ê³„**: 7ë‹¨ê³„
**ë³µì¡ë„**: â­â­â­â­â­ (ë…¸ë“œ ë¶„í•  + ì¬ì—°ê²°)

---

## í•µì‹¬ ë¬¸ì œ ë¶„ì„

### ë¬¸ì œ 1: ë…¸ë“œ ë‚´ë¶€ ìœ„ì¹˜ ì§€ì •ì˜ ì–´ë ¤ì›€

**ë°©ì‹ Bì˜ ê·¼ë³¸ì  ë¬¸ì œ**:
```
ë…¸ë“œ = messages ë¦¬ìŠ¤íŠ¸
â†’ "B ì‹œì "ì„ ì–´ë–»ê²Œ í‘œí˜„í•˜ë‚˜?
â†’ node_id + message_index í•„ìš”

ì˜ˆ: /goto node_1 3
```

**ì‚¬ìš©ì ê²½í—˜**:
```
ë°©ì‹ A: /goto B (ë…¸ë“œ ì´ë¦„)
ë°©ì‹ B: /goto node_1 3 (ë…¸ë“œ + ì¸ë±ìŠ¤)

â†’ ë°©ì‹ Bê°€ í›¨ì”¬ ë³µì¡
```

### ë¬¸ì œ 2: ë…¸ë“œ ë¶„í• ì˜ í•„ì—°ì„±

**ë°©ì‹ Bì—ì„œ ì¤‘ê°„ ì‚½ì…í•˜ë ¤ë©´**:
1. ë¨¼ì € ë…¸ë“œë¥¼ ë¶„í• í•´ì•¼ í•¨
2. ì›í•˜ëŠ” ìœ„ì¹˜ë¥¼ ë³„ë„ ë…¸ë“œë¡œ ë¶„ë¦¬
3. ê·¸ ë‹¤ìŒ ì¬ì—°ê²°

**ì˜ˆì‹œ**:
```
[A, B, C, D, E] â†’ Bì™€ D ì‚¬ì´ ì‚½ì…

1ë‹¨ê³„: ë¶„í• 
[A, B] â†’ [C] â†’ [D, E]

2ë‹¨ê³„: ìƒˆ ë…¸ë“œ ì‚½ì…
[A, B] â†’ [NEW]
      â†“
      [C]

3ë‹¨ê³„: ì¬ì—°ê²°
[A, B] â†’ [C]
      â†“
      [NEW] â†’ [D, E]
```

### ë¬¸ì œ 3: UI ë³µì¡ë„

**ë°©ì‹ A (ì›¹ UI)**:
```javascript
// ë…¸ë“œ í´ë¦­ë§Œ í•˜ë©´ ë¨
onNodeClick(nodeId) {
    currentNodeId = nodeId;
}

// ì¬ì—°ê²° (ë“œë˜ê·¸ ì•¤ ë“œë¡­)
onDragNode(sourceId, targetParentId) {
    nodes[sourceId].parentId = targetParentId;
}
```

**ë°©ì‹ B (ì›¹ UI)**:
```javascript
// ë…¸ë“œ ë‚´ë¶€ì˜ íŠ¹ì • ë©”ì‹œì§€ í´ë¦­
onMessageClick(nodeId, messageIndex) {
    currentNodeId = nodeId;
    currentMessageIndex = messageIndex;
}

// ì¬ì—°ê²° (ë¨¼ì € ë¶„í•  í•„ìš”)
onDragNode(sourceId, targetParentId) {
    // 1. ë…¸ë“œ ë¶„í•  ì—¬ë¶€ í™•ì¸
    if (needsSplit(sourceId)) {
        splitNode(sourceId, ...);
    }
    // 2. ì¬ì—°ê²°
    nodes[newNodeId].parentId = targetParentId;
}
```

---

## ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤: í”„ë¡œì íŠ¸ ìƒë‹´ ì¤‘ ì£¼ì œ ë³€ê²½

```
ëŒ€í™” íë¦„:
A: "í”„ë¡œì íŠ¸ê°€ ë§‰í˜”ì–´ìš”"
B: "ì–´ë–¤ ë¶€ë¶„ì´ ë§‰í˜”ë‚˜ìš”?"
C: "ì½”ë”©ì´ìš”" â†’ ì½”ë”© ìƒë‹´ ì‹œì‘
D: "Pythonìœ¼ë¡œ í•˜ê³  ìˆì–´ìš”"
E: "Djangoë¥¼ ì“°ê³  ìˆì–´ìš”"

ì‚¬ìš©ì ìƒê°:
"ì•„, Cì—ì„œ 'ì¼ì •'ìœ¼ë¡œ ì£¼ì œë¥¼ ë°”ê¿¨ìœ¼ë©´ ì–´ë• ì„ê¹Œ?"

ì›í•˜ëŠ” ì‘ì—…:
B ì‹œì ìœ¼ë¡œ ê°€ì„œ "ì¼ì •ì´ìš”"ë¡œ ìƒˆ ë¶„ê¸° ì‹œì‘
í•˜ì§€ë§Œ D, Eì˜ Python/Django ì •ë³´ëŠ” ìœ ì§€í•˜ê³  ì‹¶ìŒ
```

**ë°©ì‹ Aë¡œ ì²˜ë¦¬**:
```python
1. /goto B
2. ì‚¬ìš©ì: "ì¼ì •ì´ìš”"
   â†’ NEW ë…¸ë“œ ìƒì„±
3. /reparent D NEW
   â†’ Dê°€ NEWì˜ ìì‹ì´ ë¨
   â†’ EëŠ” Dì˜ ìì‹ì´ë¯€ë¡œ ìë™ìœ¼ë¡œ ë”°ë¼ê°

ê²°ê³¼:
A â†’ B â†’ C
     â†“
     NEW â†’ D â†’ E
```

**ë°©ì‹ Bë¡œ ì²˜ë¦¬**:
```python
# ìƒí™©: ëª¨ë“  ëŒ€í™”ê°€ node_1ì— ë“¤ì–´ìˆìŒ
# [AëŒ€í™”, BëŒ€í™”, CëŒ€í™”, DëŒ€í™”, EëŒ€í™”]

1. /split node_1 2 3 4 5
   â†’ [node_AB, node_C, node_D, node_E]

2. /goto node_AB
3. ì‚¬ìš©ì: "ì¼ì •ì´ìš”"
   â†’ node_NEW ìƒì„±

4. /reparent node_D node_NEW
5. (node_EëŠ” node_Dì˜ ìì‹ì´ë¯€ë¡œ ìë™ìœ¼ë¡œ ë”°ë¼ê°...
    í•˜ì§€ë§Œ ë°©ì‹ Bì—ì„œëŠ” node_Eë„ ë…ë¦½ ë…¸ë“œì´ë¯€ë¡œ
    ìˆ˜ë™ìœ¼ë¡œ ì¬ì—°ê²°í•´ì•¼ í•¨!)
    /reparent node_E node_D

ë³µì¡í•¨!
```

---

## ë…¸ë“œìƒì„±ë…¼ì˜ ë¬¸ì„œì™€ì˜ ì—°ê´€ì„±

### ì´ìŠˆ 3: ë…¸ë“œ ë¶„í• ê³¼ ê²½ë¡œ ì§€ì •ì˜ ëª¨í˜¸í•¨ (ì¬ë“±ì¥)

**ë…¸ë“œìƒì„±ë…¼ì˜_2_í•µì‹¬ì´ìŠˆ.md**ì—ì„œ:
```
ì‚¬ìš©ìì˜ ì§ˆë¬¸:
"A[a, b] B ì‚¬ì´ì—ì„œ ë¶„ê¸°í•˜ê³  ì‹¶ì€ë°,
 aì™€ b ì‚¬ì´ ì§€ì ì„ ì–´ë–»ê²Œ ëª…ì‹œí•  ê±´ê°€?"

ê²°ë¡ :
- Model B (1í„´=1ë…¸ë“œ) ì±„íƒ
- "aì™€ b ì‚¬ì´"ëŠ” ê°œë…ì ìœ¼ë¡œ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- ëŒ€ì‹  "node_a ì‹œì "ìœ¼ë¡œ í‘œí˜„
```

**í˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤ì™€ì˜ ê´€ê³„**:
```
A[a, b] B í‘œí˜„:

ë°©ì‹ A (1í„´=1ë…¸ë“œ):
node_a â†’ node_b â†’ node_B
         â†‘
      ì—¬ê¸°ì„œ ë¶„ê¸° = /goto node_a

ë°©ì‹ B (ë²„í¼ ê¸°ë°˜):
node_1 = [AëŒ€í™”(a, b), BëŒ€í™”]
         â†‘
      ì—¬ê¸°ì„œ ë¶„ê¸° = /goto node_1 1 ???
      â†’ ì• ë§¤í•¨!
```

**ê²°ë¡ **: ì´ì „ ë…¼ì˜ì˜ ê²°ë¡ ì´ ì—¬ê¸°ì„œë„ ìœ íš¨í•¨
- ë°©ì‹ AëŠ” ëª…í™•í•¨ (ë…¸ë“œ ë‹¨ìœ„ ì§€ì •)
- ë°©ì‹ BëŠ” ì• ë§¤í•¨ (ë…¸ë“œ + ì¸ë±ìŠ¤ í•„ìš”)

---

## parent_id ì¬í• ë‹¹ ê¸°ëŠ¥ì˜ í•„ìš”ì„±

### ë‘ ë°©ì‹ ëª¨ë‘ í•„ìš”í•¨

**ë°©ì‹ A**:
```python
/reparent <target_node_id> <new_parent_id>

def reparent_command(target_id: str, new_parent_id: str):
    if target_id not in all_nodes:
        print("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë…¸ë“œ")
        return

    if new_parent_id not in all_nodes:
        print("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¶€ëª¨ ë…¸ë“œ")
        return

    # ìˆœí™˜ ì°¸ì¡° ê²€ì‚¬
    if is_ancestor(new_parent_id, target_id):
        print("ìˆœí™˜ ì°¸ì¡° ë°œìƒ! (ìì‹ì„ ë¶€ëª¨ë¡œ ì„¤ì • ë¶ˆê°€)")
        return

    # ì¬ì—°ê²°
    all_nodes[target_id].parent_id = new_parent_id
    print(f"{target_id}ë¥¼ {new_parent_id}ì˜ ìì‹ìœ¼ë¡œ ì¬ì—°ê²° ì™„ë£Œ")
```

**ë°©ì‹ B** (+ ë…¸ë“œ ë¶„í• ):
```python
/split <node_id> <index1> <index2> ...
/reparent <target_node_id> <new_parent_id>

# ë°©ì‹ BëŠ” splitë„ í•„ìš”í•˜ê³  reparentë„ í•„ìš”
# â†’ ë” ë³µì¡
```

---

## ìµœì¢… ë¹„êµ

| ì¸¡ë©´ | ë°©ì‹ A (1í„´=1ë…¸ë“œ) | ë°©ì‹ B (ë²„í¼ ê¸°ë°˜) |
|------|-------------------|-------------------|
| **ì¤‘ê°„ ìœ„ì¹˜ ì§€ì •** | ê°„ë‹¨ (ë…¸ë“œ ID) | ë³µì¡ (ë…¸ë“œ + ì¸ë±ìŠ¤) |
| **ë…¸ë“œ ë¶„í• ** | ë¶ˆí•„ìš” | í•„ìˆ˜ |
| **ì¬ì—°ê²° ë³µì¡ë„** | â­â­ | â­â­â­â­â­ |
| **ëª…ë ¹ì–´ ìˆ˜** | 3ê°œ (goto, ëŒ€í™”, reparent) | 5ê°œ (goto, ëŒ€í™”, split, reparentÃ—2) |
| **UI ë³µì¡ë„** | ë‚®ìŒ (ë“œë˜ê·¸ë§Œ) | ë†’ìŒ (ë©”ì‹œì§€ ì„ íƒ + ë¶„í• ) |
| **ìˆœí™˜ ì°¸ì¡° ê²€ì‚¬** | ê°„ë‹¨ | ë³µì¡ (ë¶„í•  í›„ ê²€ì‚¬) |

---

## ê¶Œê³ ì‚¬í•­

### ì¤‘ê°„ ì‚½ì… ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë°©ì‹ Aê°€ ì••ë„ì ìœ¼ë¡œ ìš°ìˆ˜

**ì´ìœ **:
1. **ê°œë…ì  ëª…í™•ì„±**: "B ì‹œì " = node_B
2. **ì‘ì—… ë‹¨ìˆœì„±**: goto â†’ ëŒ€í™” â†’ reparent
3. **UI ì§ê´€ì„±**: ë…¸ë“œ í´ë¦­ â†’ ë“œë˜ê·¸ ì•¤ ë“œë¡­
4. **ë²„ê·¸ ìœ„í—˜ ë‚®ìŒ**: ë…¸ë“œ ë¶„í•  ë¡œì§ ë¶ˆí•„ìš”

### ë°©ì‹ BëŠ” ì¤‘ê°„ ì‚½ì…ì— ë¶€ì í•©

**ê·¼ë³¸ì  ë¬¸ì œ**:
- ë…¸ë“œ ë‚´ë¶€ ìœ„ì¹˜ ì§€ì •ì´ ì• ë§¤í•¨
- ë¶„í•  ë¡œì§ì´ ë³µì¡í•¨
- ì‚¬ìš©ì ê²½í—˜ì´ ë‚˜ì¨

**ê²°ë¡ **:
```
ë¬¼ë¦¬ì  ë…¸ë“œ ë¶„í•  ë¡œì§ = ë°©ì‹ A (1í„´=1ë…¸ë“œ)

ì¤‘ê°„ ì‚½ì… ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê³ ë ¤í•˜ë©´,
ë°©ì‹ BëŠ” ì‹¤ìš©ì„±ì´ í˜„ì €íˆ ë–¨ì–´ì§
```

---

## ë‹¤ìŒ ë‹¨ê³„

### ë°©ì‹ A êµ¬í˜„ ì‹œ ì¶”ê°€ ê¸°ëŠ¥

```python
âœ… ê¸°ë³¸ ë…¸ë“œ ìƒì„±
âœ… /save (ì²´í¬í¬ì¸íŠ¸)
âœ… /goto (ì´ë™)
âœ… get_context_path (ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ)
ğŸ†• /reparent (ì¬ì—°ê²°) â† ìƒˆë¡œ ì¶”ê°€ í•„ìš”
ğŸ†• /list_children (ìì‹ ë…¸ë“œ ì¡°íšŒ)
```

### ìˆœí™˜ ì°¸ì¡° ë°©ì§€ ì•Œê³ ë¦¬ì¦˜

```python
def is_ancestor(potential_ancestor_id: str, node_id: str) -> bool:
    """
    potential_ancestorê°€ nodeì˜ ì¡°ìƒì¸ì§€ í™•ì¸
    ìˆœí™˜ ì°¸ì¡° ë°©ì§€ìš©
    """
    current = node_id
    while current is not None:
        if current == potential_ancestor_id:
            return True
        current = all_nodes[current].parent_id
    return False
```

---

## ê²°ë¡ 

**ì¤‘ê°„ ì‚½ì…(Mid-path Insertion) ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„ ê²°ê³¼**:

1. **ë°©ì‹ A**: ê°„ë‹¨í•˜ê³  ì§ê´€ì  (ë…¸ë“œ IDë§Œìœ¼ë¡œ ì§€ì • ê°€ëŠ¥)
2. **ë°©ì‹ B**: ë³µì¡í•˜ê³  ë²„ê·¸ ìœ„í—˜ ë†’ìŒ (ë…¸ë“œ ë¶„í•  í•„ìˆ˜)

**ìµœì¢… ê¶Œê³ **:
- âœ… ë°©ì‹ A (1í„´=1ë…¸ë“œ) ì±„íƒ
- âœ… `/reparent` ëª…ë ¹ ì¶”ê°€
- âœ… ìˆœí™˜ ì°¸ì¡° ë°©ì§€ ë¡œì§ êµ¬í˜„

**ë²„í¼ ê´€ë ¨ ì§€ì ì— ëŒ€í•œ ë‹µë³€**:
- ë§ìŠµë‹ˆë‹¤. ë°©ì‹ BëŠ” goto ì‹œ ë²„í¼ ì²˜ë¦¬ê°€ ë³µì¡í•©ë‹ˆë‹¤
- í•˜ì§€ë§Œ **ì¤‘ê°„ ì‚½ì…ì€ í›¨ì”¬ ë” ë³µì¡í•œ ë¬¸ì œ**ì…ë‹ˆë‹¤
- ë°©ì‹ BëŠ” ë…¸ë“œ ë¶„í• ì´ í•„ìˆ˜ì´ë¯€ë¡œ ì‹¤ìš©ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤
