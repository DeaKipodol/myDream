# AI 고민상담 트리 구조 대화 시스템 - 마스터 일정표 (CLI 우선 방식)

- 갱신일: **2025-12-02 (v3.0 CLI-1 완료 및 요구사항 반영)**
- PM: 프로젝트 매니저 (일정 탐정)
- 프로젝트명: AI 고민상담 트리 구조 대화 시스템
- 상태: **Phase CLI-1 완료 ✅ → CLI-2 준비 중**
- 총 예상 기간: 약 8-10주 (추가 기능 반영)

---

## 프로젝트 개요

본 프로젝트는 사용자가 AI와의 대화 중 언제든지 다른 해결 경로로 전환하고, 특정 시점으로 복귀하며, 이미 쌓인 잘못된 논리를 신속히 교체할 수 있는 인터랙티브 상담 환경을 제공하는 시스템입니다.

### 개발 방식 전환
**기존 계획**: 프론트엔드/백엔드/DB를 동시 개발 (29개 Phase, 14주)
**새 계획**: CLI로 핵심 로직 검증 → UI 구축 (8개 Phase, 7-10주)

### 핵심 기술 요소 (v2.0 업데이트)
- 트리 기반 대화 경로 관리 (Tree 객체 분리 방식)
- **CLI-1**: 단순 경로 추적 (LCA 없음) → **CLI-3**: LCA 추가 (병합 기능)
- 체크포인트 = "이름표" 개념 (노드는 자동 생성)
- **1턴 = 1노드** (user_question + ai_answer)
- Python CLI (초기) → 프론트엔드: HTML/CSS/JavaScript (후기)
- 백엔드: Python/FastAPI
- 데이터베이스: 초기 JSON 파일 → NoSQL (MongoDB 또는 DynamoDB)

---

## 새로운 Phase 목록 (CLI 우선 방식) - v3.0

| Phase | 제목 | 담당자 | 상태 | 시작일 | 예상완료 | 실제완료 | 의존성 | 예상일수 |
|-------|------|--------|------|--------|---------|---------|--------|----------|
| CLI-1 | 핵심 로직 + AI 통합 | 기술개발자 | **✅ 완료** | 2025-11-29 | 2025-12-02 | 2025-12-02 | - | 4일 |
| CLI-2 | 고급 기능 (컨텍스트 참조, 노드 재배치, 영속성, 구조 개선) | 기술개발자 | 대기 | - | - | - | CLI-1 | 6-8일 |
| CLI-3 | CLI 완성 (병합, LCA) | 기술개발자 | 대기 | - | - | - | CLI-2 | 5-7일 |
| UI-1 | 최소 UI 프로토타입 | 프론트개발자 | 대기 | - | - | - | CLI-3 | 10-14일 |
| BE-1 | FastAPI 백엔드 구축 | 백엔드개발자 | 대기 | - | - | - | CLI-3 | 5-7일 |
| INT-1 | 프론트-백엔드 통합 | 전체 | 대기 | - | - | - | UI-1, BE-1 | 5-7일 |
| TEST-1 | 통합 테스트 및 버그 수정 | 전체 | 대기 | - | - | - | INT-1 | 7-10일 |
| DEPLOY-1 | 배포 및 문서화 | 전체 | 대기 | - | - | - | TEST-1 | 3-5일 |

---

## Phase 상세 설명

### Phase CLI-1: 핵심 로직 + AI 통합 - **✅ 완료 (2025-12-02)**
**목표**: 트리 구조, 경로 전환, AI 통합까지 완벽한 동작 검증

**실제 구현 내용** (원래 CLI-1 + CLI-2 일부):
- ✅ Node/Tree/Store 클래스 구현 (1턴 = 1노드)
- ✅ 체크포인트 시스템 (이름표 방식)
- ✅ 분기 자동 체크포인트 (`@branch_*`)
- ✅ Navigation History (`back`, `visits` 명령어)
- ✅ OpenAI API 통합 (`ask` 명령어)
- ✅ 노드 번호 시스템 (n1, n2, ...)
- ✅ 17개 CLI 명령어 구현
- ✅ 133개 테스트, 81% 커버리지

**산출물**:
- `core/models.py`, `core/store.py`, `core/conversation.py`, `core/path_utils.py`, `core/checkpoint.py`
- `core/ai_client.py` (OpenAI 통합)
- `cli/cli.py`, `cli/visualizer.py`
- `README_CLI.md` (17KB, 813줄)
- 테스트 스위트 (133개)

**완료 기준**: ✅ 전체 달성
- [x] 모든 명령어 동작 (17개)
- [x] 5개 사용자 시나리오 검증
- [x] 단위 테스트 81% 커버리지 (핵심 모듈 98%)
- [x] 엣지 케이스 처리

---

### Phase CLI-2: 고급 기능 (컨텍스트 참조, 노드 재배치, 영속성, 구조 개선)
**목표**: 트리 구조 고급 조작, 데이터 영속성, CLI 아키텍처 개선

**핵심 작업**:
1. **크로스노드 컨텍스트 참조** (신규 요구사항 12/2)
   - 다른 노드/경로의 대화를 현재 AI 프롬프트에 "참조 자료"로 삽입
   - 예: `ask --ref n7 "이 스펙으로 비용 계산해줘"`
   - AI가 다른 경로 대화를 자료처럼 인식

2. **노드 재배치 (Reparent)** (신규 요구사항 12/2)
   - 노드(+하위 트리)를 다른 부모 아래로 이동
   - `reparent <노드> <새부모>` 명령어
   - 순환 참조 방지 검증

3. **데이터 영속성**
   - JSON/SQLite 기반 저장소
   - 세션 저장 및 복원
   - Navigation history 영속화 (아키텍처 조언 반영)

4. **CLI 구조 개선** (아키텍처 조언 12/2)
   - 현재: `cli/cli.py` 모놀리식 (300줄+ 증가)
   - 개선: Command 패턴 분리
   - 구조: `cli/commands/ask.py`, `cli/commands/switch.py`, ...
   - 목적: 유지보수성 향상, 단일 책임 원칙

**산출물**:
- 명령어 추가: `context`, `reparent`, `save-session`, `load-session`
- `core/storage.py` (영속성 레이어)
- `cli/commands/` 디렉토리 (Command 패턴)
- 단위 테스트

**완료 기준**:
- [ ] 크로스노드 컨텍스트로 AI 질문 가능
- [ ] 노드 재배치 후 트리 무결성 유지
- [ ] 세션 저장/복원 동작
- [ ] 재시작 후 데이터 복구 확인
- [ ] CLI 명령어별 모듈 분리 완료

---

### Phase CLI-3: CLI 완성 (병합, LCA)
**목표**: 분기 병합 및 고급 트리 조작 기능 구현

**핵심 작업**:
- LCA 알고리즘 구현
- 병합 기능 (`merge_branch`)
- 병합 후보 탐색 (`show_merge_candidates`)
- 이벤트 로그
- 성능 최적화

**산출물**:
- 명령어 추가: `show_merge_candidates`, `merge_branch`, `show_events`
- 통합 테스트
- 성능 측정 보고서

**완료 기준**:
- [ ] LCA 기반 병합 동작
- [ ] 통합 테스트 통과
- [ ] 성능 측정 완료 (경로 전환 지연 < 10ms)

---

<!--
============================================================
레거시: 기존 CLI-2 계획 (v2.0) - CLI-1에서 조기 구현됨
============================================================

### [LEGACY] Phase CLI-2: LLM 연결 및 컨텍스트 검증 (v2.0)
**상태**: CLI-1에서 조기 구현 완료 (OpenAI 통합)

**원래 계획**:
- LLM 프로바이더 추상화 레이어
- 더미 LLM 구현 (테스트용)
- 실제 LLM API 통합 (OpenAI 또는 Anthropic)
- 컨텍스트 블록 생성 로직
- 토큰 한도 관리

**실제**: CLI-1에서 OpenAI API 직접 통합 (사용자 요청)
-->

---

### Phase UI-1: 최소 UI 프로토타입
**목표**: CLI를 시각적 인터페이스로 전환

**핵심 작업**:
- HTML/CSS/JS 기반 프론트엔드
- 트리 뷰 시각화
- 대화 뷰 컴포넌트
- 브레드크럼 네비게이션
- CLI 함수 호출 (API 형태)

**산출물**:
- `frontend/` 디렉토리 전체
- UI 프로토타입 데모

**완료 기준**:
- [ ] CLI의 모든 기능이 UI에서 클릭으로 작동
- [ ] 시각적 피드백 (하이라이트, 애니메이션)
- [ ] 반응형 레이아웃

---

### Phase BE-1: FastAPI 백엔드 구축
**목표**: CLI 함수를 REST API로 노출

**핵심 작업**:
- FastAPI 기본 구조
- CLI 함수를 엔드포인트로 래핑
- 요청/응답 검증 (Pydantic)
- 에러 처리

**산출물**:
- `backend/app/` 디렉토리
- API 명세 (OpenAPI)

**완료 기준**:
- [ ] 모든 CLI 함수가 API로 노출
- [ ] API 문서 자동 생성 (/docs)
- [ ] 단위 테스트 통과

---

### Phase INT-1: 프론트-백엔드 통합
**목표**: UI와 백엔드를 연결하여 완전한 시스템 구축

**핵심 작업**:
- CORS 설정
- API 클라이언트 (fetch/axios)
- 에러 처리 UI
- 로딩 상태 표시

**완료 기준**:
- [ ] UI에서 백엔드 API 호출 성공
- [ ] 경로 전환 E2E 테스트 통과

---

### Phase TEST-1: 통합 테스트 및 버그 수정
**목표**: 전체 시스템의 안정성 확보

**핵심 작업**:
- E2E 테스트 (Playwright 또는 Selenium)
- 성능 테스트
- 버그 수정

**완료 기준**:
- [ ] 모든 E2E 시나리오 통과
- [ ] 성능 목표 달성 (경로 전환 < 200ms)

---

### Phase DEPLOY-1: 배포 및 문서화
**목표**: 배포 가능한 상태로 마무리

**핵심 작업**:
- Dockerfile 작성
- docker-compose 설정
- 배포 문서 작성
- 데모 비디오 제작

**완료 기준**:
- [ ] 로컬 Docker 실행 성공
- [ ] 배포 문서 완성
- [ ] 데모 비디오 제작

---

## 크리티컬 패스 (가장 오래 걸리는 경로)

```
CLI-1 (4일) ✅ 완료 (2025-12-02)
  → CLI-2 (6-8일) - 신규 요구사항 + 아키텍처 개선
  → CLI-3 (5-7일)
  → UI-1 (10-14일, CLI-3 완료 후 시작)
  → BE-1 (5-7일, CLI-3 완료 후 병렬 가능하나 UI-1 우선)
  → INT-1 (5-7일)
  → TEST-1 (7-10일)
  → DEPLOY-1 (3-5일)
```

**총 크리티컬 패스 예상 기간: 약 45-62일 (6.5-9주)** - CLI-1 조기 완료로 단축

---

## 병렬 작업 가능 구간

### 구간 1: CLI 완성 후 (CLI-3 완료 시점)
- **UI-1 (프론트엔드 개발)** ∥ **BE-1 (백엔드 API 래핑)**
  - 단, UI-1을 우선 시작하고, BE-1은 UI-1이 50% 진행된 후 시작 권장
  - 이유: CLI 함수가 완성되어 있으므로 UI 설계가 명확해진 후 API를 설계하는 것이 효율적

**병렬 작업 고려 후 예상 기간: 약 7-10주**

---

## 마일스톤

| 마일스톤 | Phase | 목표일 | 상태 | 설명 |
|---------|-------|--------|------|------|
| M1: CLI MVP | CLI-1 | Week 2 | ✅ **완료** (12/2) | 트리 구조, 경로 전환, AI 통합 검증 완료 |
| M2: 고급 기능 | CLI-2 | Week 3-4 | 대기 | 컨텍스트 참조, 노드 재배치, 영속성, 구조 개선 |
| M3: CLI 완성 | CLI-3 | Week 5-6 | 대기 | 병합, LCA 기능 |
| M4: UI 프로토타입 | UI-1 | Week 8-9 | 대기 | 시각적 인터페이스 구축 |
| M5: 통합 완료 | INT-1 | Week 10-11 | 대기 | 프론트-백엔드 통합 |
| M6: 배포 준비 | DEPLOY-1 | Week 12 | 대기 | 배포 가능 상태 |

---

## Phase 진행 상황 요약

- **완료 (Completed)**: 1개 (CLI-1 ✅)
- **대기 (Pending)**: 7개 Phase (CLI-2, CLI-3, UI-1, BE-1, INT-1, TEST-1, DEPLOY-1)
- **진행중 (In Progress)**: 0개
- **보류 (On Hold)**: 0개
- **취소 (Cancelled)**: 0개

---

## 기존 계획과의 비교

### 기존 계획 (29개 Phase, 14주)
- 프론트엔드, 백엔드, DB를 동시 개발
- 초기부터 완전한 시스템 구축 목표
- 높은 재작업 리스크

### 새 계획 (8개 Phase, 7-10주)
- CLI로 핵심 로직 먼저 검증
- 검증된 로직 위에 UI 구축
- 낮은 실패 확률, 빠른 피드백 루프

---

## 위험 요소 및 대응 계획

### 기술 위험
1. **CLI에 빠져서 UI를 영원히 안 만듦**
   - 대응: CLI-3 완료 후 즉시 UI-1 시작 (PM 강제 전환)
   - 지표: CLI-3 완료 후 2주 내 UI 프로토타입 시작

2. **LLM API 비용 초과**
   - 대응: CLI-2에서 더미 LLM으로 먼저 테스트
   - 예산: 초기 개발 단계 월 $50 이내

3. **CLI 로직이 UI로 이식될 때 문제 발생**
   - 대응: CLI 함수 설계 시 "UI 계약" 주석 필수 작성
   - 검증: CLI-3 완료 시 UI 설계 검토 미팅

### 일정 위험
1. **CLI-1 예상보다 오래 걸림**
   - 대응: 주간 체크포인트에서 진행률 체크, 필요 시 범위 축소
   - 최소 목표: 경로 전환만 동작해도 CLI-2 진행 가능

2. **UI 개발 경험 부족**
   - 대응: UI 라이브러리 사용 고려 (예: D3.js for 트리 시각화)
   - 대안: CLI만 완성하고 UI는 2차 목표로 전환

---

## 다음 액션

### Phase CLI-1 관련 (완료)
1. ✅ **완료**: Phase CLI-1 상세 개발지시서 작성 완료 (v2.0)
2. ✅ **완료**: 담당자 개발방향 전환 공지 확인 완료
3. ✅ **완료**: LCA 의사결정 가이드 작성 완료 (Option C 채택)
4. ✅ **완료**: 아키텍처 팀 의견서 검토 완료
5. ✅ **완료**: 물리적 노드 분할 로직 구체화 (1턴=1노드, Tree 분리 방식)
6. ✅ **완료**: 노드 생성 방식 최종 결정 (Option A - Tree 객체 분리)
7. ✅ **완료**: Phase CLI-1 설계서 업데이트 (v2.0 발행)
8. ✅ **완료**: 기술총괄 구현계획서 v2.0 업데이트 (PM 시나리오 통합)
9. ✅ **완료**: PM 개발지시서 v2.0 업데이트 (기술총괄 Store 방식 반영)
10. ✅ **완료**: **Phase CLI-1 개발 완료** (2025-11-29 ~ 2025-12-02, 4일)

### Phase CLI-2 준비 (다음 단계)
11. 🚀 **대기**: Phase CLI-2 개발지시서 작성 (신규 요구사항 반영)
12. 📋 **대기**: 크로스노드 컨텍스트 참조 상세 설계
13. 📋 **대기**: 노드 재배치(Reparent) 기능 상세 설계
14. 📋 **대기**: 데이터 영속성 레이어 설계 (JSON/SQLite)

---

## 변경 이력

| 날짜 | 변경 사항 | 사유 |
|------|-----------|------|
| 2025-11-05 (초) | 초안 작성 (29개 Phase, 14주) | 프로젝트 시작 |
| 2025-11-05 (v2) | CLI 우선 방식으로 전환 (8개 Phase, 7-10주) | 핵심 로직 조기 검증 및 실패 확률 감소 |
| 2025-11-09 | LCA 의사결정 및 노드 분할 로직 논의 시작 | 구현 세부사항 구체화 |
| 2025-11-09 (v2.0) | 노드 분할/Store 설계 최종 결정, 개발 착수 가능 상태 | Option A 채택, 문서 v2.0 발행 |
| **2025-12-02 (v3.0)** | **CLI-1 완료, CLI-2 요구사항 변경** | **신규 요구사항 반영 (크로스노드 컨텍스트, 노드 재배치)** |

---

## 2025-11-09 진행 상황 상세

### ✅ 완료된 사항

#### 1. LCA 의사결정 최종 결정
- **문서**: `LCA_의사결정_가이드.md` 작성 완료
- **결정**: Option C (Hybrid 접근법) 채택
  - Phase CLI-1: 단순 경로 추적만 (LCA 없음)
  - Phase CLI-3: LCA 추가 (병합 기능 구현 시)
- **근거**: plan.md에서 병합 기능이 5곳에서 명시됨 (Lines 38, 46, 55-59, 542, 410)
- **효과**: Phase CLI-1 구현 복잡도 75% 감소 (1200줄 → 300줄)

#### 2. 아키텍처 팀 의견서 검토
- **문서**: `아키텍처_팀_의견서.md` 검토 완료
- **결과**: Option C 승인 ✅
- **확인 사항**:
  - 4-layer 아키텍처 일관성 유지
  - 0 리팩토링 비용 (추가만, 수정 없음)
  - 확장성 보장

#### 3. 노드 생성 논의 문서 분석
- **문서 3개 검토 완료**:
  1. `노드생성논의_1_논리전개.md`: 6단계 논의 흐름, 최종 결정 "1턴=1노드" 자동 생성
  2. `노드생성논의_2_핵심이슈.md`: 6개 핵심 이슈 및 해결 방안
  3. `노드생성논의_3_개념기술정리.md`: 기술 개념 및 7개 미해결 질문

### ✅ 완료: 물리적 노드 분할 로직 최종 결정 (v2.0)

#### 최종 결정 사항

**노드 분할 단위**: ✅ 방법 A 채택
- **1턴(Q+A) = 1노드** (즉시 생성)
- Node 구조: `user_question` + `ai_answer`
- shelves 버퍼 제거 → 트리에 자동 보존

**Store 설계**: ✅ Option A 채택 (기술총괄 방식)
- **Tree 객체 분리** (단일 책임 원칙)
- `active_path_ids: List[str]` 경로 추적 (O(1) 조회)
- 웹 전환 시 리팩토링 0줄

**체크포인트**: ✅ "이름표" 개념
- 노드는 자동 생성되어 있음
- `/save`는 단순히 이름 → node_id 매핑
- "저장"이 아니라 "이름표 붙이기"

#### 의사결정 최종 정리

| 우선순위 | 항목 | 상태 | 결정 |
|---------|------|------|------|
| 1 | 노드 분할 단위 결정 | ✅ 결정완료 | 방법 A (1턴=1노드) |
| 2 | 생성 시점 결정 | ✅ 결정완료 | 즉시 생성 (자동) |
| 3 | Store 설계 방식 | ✅ 결정완료 | Option A (Tree 분리) |
| 4 | 구현 세부사항 | ✅ 결정완료 | 개발지시서 v2.0 반영 |

#### 완료된 문서

| 문서 | 위치 | 버전 |
|------|------|------|
| PM 개발지시서 | `docs/PM_관리/PM_개발지시/phase_CLI-1_개발지시서_v2.md` | v2.0 |
| 기술총괄 구현계획서 | `docs/초기개발/기술총괄_Phase_CLI-1_구현계획서.md` | v2.0 |

---

---

## 현재 상태 (v3.0)

**Phase CLI-1**: ✅ **완료** (2025-11-29 ~ 2025-12-02, 4일)
- 133개 테스트 전체 통과
- 81% 커버리지 (핵심 모듈 98%)
- 17개 CLI 명령어 구현
- OpenAI API 통합 완료
- README_CLI.md 작성 완료 (17KB)

**Phase CLI-2**: 📋 **준비 중** (예상 6-8일)
- 신규 요구사항 (2025-12-02):
  1. 크로스노드 컨텍스트 참조
  2. 노드 재배치 (Reparent)
  3. 데이터 영속성
- 아키텍처 조언 반영 (2025-12-02):
  4. CLI Command 패턴 분리 (`cli/commands/`)
  5. Navigation History 영속화

**다음 단계**: Phase CLI-2 개발지시서 작성 및 상세 설계

**참조 문서**:
- `PHASE_CLI-1_COMPLETE.md` - CLI-1 완료 보고서
- `README_CLI.md` - CLI 사용자 가이드
- PM 개발지시서 v2.0, 구현계획서 v2.0
